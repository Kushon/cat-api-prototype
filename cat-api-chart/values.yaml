# Default values for cat-api Helm chart
# This is a YAML-formatted file.

# Global configuration
global:
  namespace: cat-api-ns
  environment: development

# Whether to create the namespace (set to false if it already exists)
createNamespace: false

# Cat API Application Configuration
catApi:
  enabled: true
  
  # Image configuration
  image:
    repository: cat-api
    tag: latest
    pullPolicy: Never  # Use IfNotPresent in production
  
  # Deployment configuration
  deployment:
    replicas: 1
    strategy:
      type: RollingUpdate
      rollingUpdate:
        maxSurge: 1
        maxUnavailable: 0
  
  # Pod configuration
  podAnnotations: {}
  
  podSecurityContext: {}
    # runAsNonRoot: true
    # runAsUser: 1000
  
  securityContext: {}
    # allowPrivilegeEscalation: false
    # readOnlyRootFilesystem: true
    # capabilities:
    #   drop:
    #     - ALL
  
  # Resource limits and requests
  resources:
    limits:
      cpu: 500m
      memory: 512Mi
    requests:
      cpu: 250m
      memory: 256Mi
  
  # Liveness and readiness probes
  livenessProbe:
    enabled: false
    httpGet:
      path: /
      port: http
    initialDelaySeconds: 30
    periodSeconds: 10
  
  readinessProbe:
    enabled: false
    httpGet:
      path: /
      port: http
    initialDelaySeconds: 5
    periodSeconds: 5
  
  startupProbe:
    enabled: false
    httpGet:
      path: /
      port: http
    initialDelaySeconds: 5
    periodSeconds: 5
    failureThreshold: 30
  
  # Service configuration
  service:
    enabled: true
    type: ClusterIP
    port: 8000
    targetPort: 8000
    annotations: {}
  
  # Ingress configuration
  ingress:
    enabled: false
    className: nginx
    annotations:
      nginx.ingress.kubernetes.io/rewrite-target: /
    hosts:
      - host: 192.168.49.2
        paths:
          - path: /
            pathType: Prefix
    tls: []
    # - secretName: cat-api-tls
    #   hosts:
    #     - 192.168.49.2
  
  # Environment variables from ConfigMap
  config:
    DB_HOST: "postgres-service"
    DB_PORT: "5432"
    DB_NAME: postgres
  
  # Secrets configuration
  secrets:
    # These should be created externally or set via --set
    postgresql:
      username: postgres
      password: postgres  # Change this in production!
  
  # Migration Job configuration
  migration:
    enabled: false
    backoffLimit: 4
    image:
      repository: cat-api
      tag: latest
      pullPolicy: Never
    resources:
      limits:
        cpu: 500m
        memory: 512Mi
      requests:
        cpu: 250m
        memory: 256Mi

# PostgreSQL Sub-chart Configuration
postgres:
  enabled: true
  
  image:
    repository: postgres
    tag: "15"
    pullPolicy: IfNotPresent
  
  # StatefulSet configuration
  statefulSet:
    replicas: 1
  
  service:
    name: postgres-service
    type: ClusterIP
    port: 5432
    targetPort: 5432
    clusterIP: None  # Headless service for StatefulSet
  
  # Storage configuration
  storage:
    size: 5Gi
    accessModes:
      - ReadWriteOnce
    # storageClassName: standard
  
  # Credentials
  auth:
    username: postgres
    password: postgres  # Change this in production!
    database: postgres
  
  # Environment variables for PostgreSQL
  config:
    POSTGRES_DB: postgres
    PGDATA: /var/lib/postgresql/data/pgdata
  
  # Resource configuration
  resources:
    limits:
      cpu: 1000m
      memory: 1Gi
    requests:
      cpu: 500m
      memory: 512Mi
  
  # Health check
  readinessProbe:
    enabled: true
    command:
      - pg_isready
      - -U
      - postgres
    initialDelaySeconds: 5
    periodSeconds: 10
    timeoutSeconds: 5
    successThreshold: 1
    failureThreshold: 3

# RBAC Configuration
rbac:
  create: true

# Service Account
serviceAccount:
  create: true
  annotations: {}
  name: ""

# Autoscaling (if using HPA)
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 3
  targetCPUUtilizationPercentage: 80
  targetMemoryUtilizationPercentage: 80

# Node selector
nodeSelector: {}

# Tolerations
tolerations: []

# Affinity
affinity: {}
